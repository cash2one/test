function parseBigInt(a,b){return new BigInteger(a,b)}function linebrk(a,b){for(var c="",d=0;d+b<a.length;)c+=a.substring(d,d+b)+"\n",d+=b;return c+a.substring(d,a.length)}function byte2Hex(a){return 16>a?"0"+a.toString(16):a.toString(16)}function pkcs1unpad2(a,b){for(var c=a.toByteArray(),d=0;d<c.length&&0==c[d];)++d;if(c.length-d!=b-1||2!=c[d])return null;for(++d;0!=c[d];)if(++d>=c.length)return null;for(var e="";++d<c.length;)e+=String.fromCharCode(c[d]);return e}function pkcs1pad2(a,b){if(b<a.length+11)return alert("Message too long for RSA"),null;for(var c=new Array,d=a.length-1;d>=0&&b>0;)c[--b]=a.charCodeAt(d--);c[--b]=0;for(var e=new SecureRandom,f=new Array;b>2;){for(f[0]=0;0==f[0];)e.nextBytes(f);c[--b]=f[0]}return c[--b]=2,c[--b]=0,new BigInteger(c)}"undefined"!=typeof pidCrypt&&"undefined"!=typeof BigInteger&&"undefined"!=typeof SecureRandom&&"undefined"!=typeof Arcfour&&(pidCrypt.RSA=function(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null},pidCrypt.RSA.prototype.doPrivate=function(a){if(null==this.p||null==this.q)return a.modPow(this.d,this.n);for(var b=a.mod(this.p).modPow(this.dmp1,this.p),c=a.mod(this.q).modPow(this.dmq1,this.q);b.compareTo(c)<0;)b=b.add(this.p);return b.subtract(c).multiply(this.coeff).mod(this.p).multiply(this.q).add(c)},pidCrypt.RSA.prototype.setPublic=function(a,b,c){"undefined"==typeof c&&(c=16),null!=a&&null!=b&&a.length>0&&b.length>0?(this.n=parseBigInt(a,c),this.e=parseInt(b,c)):alert("Invalid RSA public key")},pidCrypt.RSA.prototype.doPublic=function(a){return a.modPowInt(this.e,this.n)},pidCrypt.RSA.prototype.encryptRaw=function(a){var b=pkcs1pad2(a,this.n.bitLength()+7>>3);if(null==b)return null;var c=this.doPublic(b);if(null==c)return null;var d=c.toString(16);return 0==(1&d.length)?d:"0"+d},pidCrypt.RSA.prototype.encrypt=function(a){return a=pidCryptUtil.encodeBase64(a),this.encryptRaw(a)},pidCrypt.RSA.prototype.decryptRaw=function(a){var b=parseBigInt(a,16),c=this.doPrivate(b);return null==c?null:pkcs1unpad2(c,this.n.bitLength()+7>>3)},pidCrypt.RSA.prototype.decrypt=function(a){var b=this.decryptRaw(a);return b=b?pidCryptUtil.decodeBase64(b):""},pidCrypt.RSA.prototype.setPrivate=function(a,b,c,d){"undefined"==typeof d&&(d=16),null!=a&&null!=b&&a.length>0&&b.length>0?(this.n=parseBigInt(a,d),this.e=parseInt(b,d),this.d=parseBigInt(c,d)):alert("Invalid RSA private key")},pidCrypt.RSA.prototype.setPrivateEx=function(a,b,c,d,e,f,g,h,i){"undefined"==typeof i&&(i=16),null!=a&&null!=b&&a.length>0&&b.length>0?(this.n=parseBigInt(a,i),this.e=parseInt(b,i),this.d=parseBigInt(c,i),this.p=parseBigInt(d,i),this.q=parseBigInt(e,i),this.dmp1=parseBigInt(f,i),this.dmq1=parseBigInt(g,i),this.coeff=parseBigInt(h,i)):alert("Invalid RSA private key")},pidCrypt.RSA.prototype.generate=function(a,b){var c=new SecureRandom,d=a>>1;this.e=parseInt(b,16);for(var e=new BigInteger(b,16);;){for(;this.p=new BigInteger(a-d,1,c),0!=this.p.subtract(BigInteger.ONE).gcd(e).compareTo(BigInteger.ONE)||!this.p.isProbablePrime(10););for(;this.q=new BigInteger(d,1,c),0!=this.q.subtract(BigInteger.ONE).gcd(e).compareTo(BigInteger.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var f=this.p;this.p=this.q,this.q=f}var g=this.p.subtract(BigInteger.ONE),h=this.q.subtract(BigInteger.ONE),i=g.multiply(h);if(0==i.gcd(e).compareTo(BigInteger.ONE)){this.n=this.p.multiply(this.q),this.d=e.modInverse(i),this.dmp1=this.d.mod(g),this.dmq1=this.d.mod(h),this.coeff=this.q.modInverse(this.p);break}}},pidCrypt.RSA.prototype.getASNData=function(a){var c=[],d=0;if(a.value&&"INTEGER"==a.type&&(c[d++]=a.value),a.sub)for(var e=0;e<a.sub.length;e++)c=c.concat(this.getASNData(a.sub[e]));return c},pidCrypt.RSA.prototype.setKeyFromASN=function(a,b){var c=["N","E","D","P","Q","DP","DQ","C"],d={},e=this.getASNData(b);switch(a){case"Public":case"public":for(var f=0;f<e.length;f++)d[c[f]]=e[f].toLowerCase();this.setPublic(d.N,d.E,16);break;case"Private":case"private":for(var f=1;f<e.length;f++)d[c[f-1]]=e[f].toLowerCase();this.setPrivateEx(d.N,d.E,d.D,d.P,d.Q,d.DP,d.DQ,d.C,16)}},pidCrypt.RSA.prototype.setPublicKeyFromASN=function(a){this.setKeyFromASN("public",a)},pidCrypt.RSA.prototype.setPrivateKeyFromASN=function(a){this.setKeyFromASN("private",a)},pidCrypt.RSA.prototype.getParameters=function(){var a={};return null!=this.n&&(a.n=this.n),a.e=this.e,null!=this.d&&(a.d=this.d),null!=this.p&&(a.p=this.p),null!=this.q&&(a.q=this.q),null!=this.dmp1&&(a.dmp1=this.dmp1),null!=this.dmq1&&(a.dmq1=this.dmq1),null!=this.coeff&&(a.c=this.coeff),a});